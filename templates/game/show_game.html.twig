{% extends 'base.html.twig' %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/style/plateau.css') }}">
{% endblock %}

{% block body %}

    <div id="loading_screen" style="background-color: #404040; position: absolute; height: 100vh; width: 100vw; margin: 0; padding: 0; top: 0; left: 0">
        Loading !
    </div>
    <div class="row">
        <div class="col-8">
            Cartes de l'adversaire
            {% if game.getUser1().getId() == user_id %}
                {% for card in set.user2HandCards %}
                    <img height="100" src="{{ asset('assets/images/objects/'~cards[card].picture) }}">{{ cards[card].number }}
                {% endfor %}
            {% else %}
                {% for card in set.user1HandCards %}
                    <img height="100" src="{{ asset('assets/images/objects/'~cards[card].picture) }}">{{ cards[card].number }}
                {% endfor %}
            {% endif %}
        </div>
        <div class="col-4">
            Actions
        </div>
    </div>
    <div class="row">
        Plateau adversaire
    </div>
    <div class="row">
        Plateau
    </div>
    <div class="row">
        Mon Plateau
    </div>
    <div class="row">
        <div class="col-8">
            {% if game.getUser1().getId() == user_id %}
                {% for card in set.user1HandCards %}
                    <img data-card-id="{{ cards[card].getId() }}" class="card" height="100" src="{{ asset('assets/images/objects/'~cards[card].picture) }}">{{ cards[card].number }}
                {% endfor %}
            {% else %}
                {% for card in set.user2HandCards %}
                    <img data-card-id="{{ cards[card].getId()}}" class="card" height="100" src="{{ asset('assets/images/objects/'~cards[card].picture) }}">{{ cards[card].number }}
                {% endfor %}
            {% endif %}
        </div>
        <div class="col-4">
            Mes Actions
            <div class="actions">
                <button id="secret-button">Secret</button>
                <button id="depot-button">Dépôt</button>
                <button id="offre-button">Offre</button>
                <button id="echange-button">Echange</button>
            </div>
        </div>
    </div>
    <a href="{{ path('home') }}">Retour à l'accueil</a>
    <script>
        socket.on('action',(data)=>{
            console.log(data)
        })
        window.addEventListener('load',()=>{
            document.getElementById('loading_screen').style.display = 'none';
            /*let cards = document.getElementsByClassName('card-container')
            console.log(cards)
            Array.from(cards).forEach((card)=>{
                let secret = document.createElement('button')
                secret.innerHTML = "Secret"
                secret.onclick = ()=>{secretCard(card.getAttribute("data-card-id"))}
                card.appendChild(secret)
            })*/
        })

        window.addEventListener('DOMContentLoaded',()=>{
            let secretButton = document.getElementById('secret-button')
            let depotButton = document.getElementById('depot-button')
            let offreButton = document.getElementById('offre-button')
            let echangeButton = document.getElementById('echange-button')

            secretButton.addEventListener('click',(e)=>{
                let cards = document.getElementsByClassName('card')
                Array.from(cards).forEach((card)=>{
                    card.addEventListener('click',actionCard)
                })
            })
        })

        function actionCard(e){
            let cards = document.getElementsByClassName('card')
            e.target.style.transform = "translateY(-30px)"
            secretCard(e.target.getAttribute('data-card-id'))
            Array.from(cards).forEach((card)=>{
                card.removeEventListener('click',actionCard)
            })
        }

        function secretCard(cardId){
            console.log(`carte id:${cardId} cliquée`)
            fetch(`{{ path('action_game',{game:game.getId()}) }}?action=secret&carte=${cardId}`,{
                method:'GET'
            })
            .then(data=>{
                return data.json()
            })
            .then(data=>{
                console.log(data)
                document.location.reload()
            })
        }
    </script>
{% endblock %}

{% block title %}
    Résultats de la game N°{{ game.getId() }}
{% endblock %}

